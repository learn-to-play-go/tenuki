{"version":3,"sources":["../src/board-state.js"],"names":[],"mappings":"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","file":"board-state.js","sourcesContent":["import utils from \"./utils\";\nimport Intersection from \"./intersection\";\nimport Zobrist from \"./zobrist\";\n\nconst BoardState = function({ moveNumber, playedPoint, color, pass, blackPassStones, whitePassStones, intersections, blackStonesCaptured, whiteStonesCaptured, capturedPositions, koPoint, boardSize, labelPoint, labelType, hidePlayedPoint }) {\n  this.moveNumber = moveNumber;\n  this.playedPoint = playedPoint;\n  this.color = color;\n  this.pass = pass;\n  this.blackPassStones = blackPassStones;\n  this.whitePassStones = whitePassStones;\n  this.intersections = intersections;\n  this.blackStonesCaptured = blackStonesCaptured;\n  this.whiteStonesCaptured = whiteStonesCaptured;\n  this.capturedPositions = capturedPositions;\n  this.koPoint = koPoint;\n  this.boardSize = boardSize;\n  this.labelPoint = labelPoint;\n  this.labelType = labelType;\n  this.hidePlayedPoint = hidePlayedPoint;\n  this._positionHash = Zobrist.hash(boardSize, intersections);\n\n  Object.freeze(this);\n};\n\nBoardState.prototype = {\n  copyWithAttributes: function(attrs) {\n    const retrieveProperties = ({ moveNumber, playedPoint, color, pass, blackPassStones, whitePassStones, intersections, blackStonesCaptured, whiteStonesCaptured, capturedPositions, koPoint, boardSize, labelPoint, labelType, hidePlayedPoint }) => ({ moveNumber, playedPoint, color, pass, blackPassStones, whitePassStones, intersections, blackStonesCaptured, whiteStonesCaptured, capturedPositions, koPoint, boardSize, labelPoint, labelType, hidePlayedPoint });\n    const existingAttrs = retrieveProperties(this);\n    const newAttrs = retrieveProperties(Object.assign(existingAttrs, attrs));\n\n    return new BoardState(newAttrs);\n  },\n\n  _capturesFrom: function(y, x, color) {\n    const capturedNeighbors = this.neighborsFor(y, x).filter(neighbor => {\n      // TODO: this value of 1 is potentially weird.\n      // we're checking against the move before the stone we just played\n      // where this space is not occupied yet. things should possibly be\n      // reworked.\n      return !neighbor.isEmpty() && neighbor.value !== color && this.libertiesAt(neighbor.y, neighbor.x) === 1;\n    });\n\n    const capturedStones = utils.flatMap(capturedNeighbors, neighbor => this.groupAt(neighbor.y, neighbor.x));\n\n    return utils.unique(capturedStones);\n  },\n\n  _updateIntersection: function(intersection, intersections, color, label) {\n    return intersections.map(i => {\n      if (i.y === intersection.y && i.x === intersection.x) {\n        return new Intersection(i.y, i.x, color, label);\n      } else {\n        return i;\n      }\n    });\n  },\n\n  _removeIntersection: function(intersection, intersections) {\n    return this._updateIntersection(intersection, intersections, \"empty\");\n  },\n\n  _withoutIntersectionsMatching: function(condition) {\n    const newPoints = this.intersections.map(i => {\n      if (condition(i)) {\n        return new Intersection(i.y, i.x, \"empty\");\n      } else {\n        return i;\n      }\n    });\n\n    return this._withNewPoints(newPoints);\n  },\n\n  _withNewPoints: function(newPoints) {\n    return this.copyWithAttributes({ intersections: newPoints });\n  },\n\n  nextColor: function() {\n    if (this.color === \"black\") {\n      return \"white\";\n    } else {\n      return \"black\";\n    }\n  },\n\n  setColor: function(color) {\n    return this.copyWithAttributes({ color: color });\n  },\n\n  yCoordinateFor: function(y) {\n    return this.boardSize - y;\n  },\n\n  xCoordinateFor: function(x) {\n    const letters = [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"J\", \"K\", \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\"];\n\n    return letters[x];\n  },\n\n  playPass: function(color) {\n    const stateInfo = {\n      moveNumber: this.moveNumber + 1,\n      playedPoint: null,\n      color: color,\n      pass: true,\n      blackPassStones: this.blackPassStones,\n      whitePassStones: this.whitePassStones,\n      intersections: this.intersections,\n      blackStonesCaptured: this.blackStonesCaptured,\n      whiteStonesCaptured: this.whiteStonesCaptured,\n      capturedPositions: [],\n      koPoint: null,\n      boardSize: this.boardSize,\n      labelPoint: null,\n      labelType: null\n    };\n\n    stateInfo[color + \"PassStones\"] += 1;\n\n    const newState = new BoardState(stateInfo);\n\n    return newState;\n  },\n\n  _simpleKoPoint: function() {\n    let simpleKoPoint = null;\n\n    if (this.playedPoint) {\n      const { y, x } = this.playedPoint;\n\n      if (this.capturedPositions.length === 1 && this.groupAt(y, x).length === 1 && this.inAtari(y, x)) {\n        simpleKoPoint = this.capturedPositions[0];\n      }\n    }\n\n    return simpleKoPoint;\n  },\n\n  labelAt: function(y, x, label) {\n    let intersection = this.intersectionAt(y, x);\n    let newPoints = this.intersections;\n    newPoints = this._updateIntersection(intersection, newPoints, intersection.value, label);\n    let newState = this.copyWithAttributes({ intersections: newPoints, labelPoint: { y: y, x: x }, labelType: label });\n    return newState;\n  },\n\n  playAt: function(y, x, playedColor, hidePlayedPoint = false) {\n    const capturedPositions = this._capturesFrom(y, x, playedColor);\n    let playedPoint = this.intersectionAt(y, x);\n    let newPoints = this.intersections;\n\n    capturedPositions.forEach(i => {\n      newPoints = this._removeIntersection(i, newPoints);\n    });\n\n    newPoints = this._updateIntersection(playedPoint, newPoints, playedColor);\n\n    const newTotalBlackCaptured = this.blackStonesCaptured + (playedColor === \"black\" ? 0 : capturedPositions.length);\n    const newTotalWhiteCaptured = this.whiteStonesCaptured + (playedColor === \"white\" ? 0 : capturedPositions.length);\n\n    const boardSize = this.boardSize;\n\n    const moveInfo = {\n      moveNumber: this.moveNumber + 1,\n      playedPoint: Object.freeze({ y, x }),\n      color: playedColor,\n      pass: false,\n      blackPassStones: this.blackPassStones,\n      whitePassStones: this.whitePassStones,\n      intersections: newPoints,\n      blackStonesCaptured: newTotalBlackCaptured,\n      whiteStonesCaptured: newTotalWhiteCaptured,\n      capturedPositions: capturedPositions,\n      boardSize: boardSize,\n      labelPoint: null,\n      hidePlayedPoint: hidePlayedPoint\n    };\n\n    const withPlayedPoint = new BoardState(moveInfo);\n\n    const possibleKoPoint = withPlayedPoint._simpleKoPoint();\n\n    if (possibleKoPoint) {\n      moveInfo[\"koPoint\"] = { y: possibleKoPoint.y, x: possibleKoPoint.x };\n    } else {\n      moveInfo[\"koPoint\"] = null;\n    }\n\n    return new BoardState(moveInfo);\n  },\n\n  intersectionAt: function(y, x) {\n    if (y >= this.boardSize || x >= this.boardSize) {\n      throw new Error(`Intersection at (${y}, ${x}) would be outside the board`);\n    }\n\n    if (y < 0 || x < 0) {\n      throw new Error(`Intersection position cannot be negative, but was given (${y}, ${x})`);\n    }\n\n    return this.intersections[y*this.boardSize + x];\n  },\n\n  groupAt: function(y, x) {\n    const startingPoint = this.intersectionAt(y, x);\n\n    const [group, _] = this.partitionTraverse(startingPoint, neighbor => {\n      return neighbor.sameColorAs(startingPoint);\n    });\n\n    return group;\n  },\n\n  libertiesAt: function(y, x) {\n    const point = this.intersectionAt(y, x);\n\n    const emptyPoints = utils.flatMap(this.groupAt(point.y, point.x), groupPoint => {\n      return this.neighborsFor(groupPoint.y, groupPoint.x).filter(intersection => intersection.isEmpty());\n    });\n\n    return utils.unique(emptyPoints).length;\n  },\n\n  inAtari: function(y, x) {\n    return this.libertiesAt(y, x) === 1;\n  },\n\n  neighborsFor: function(y, x) {\n    const neighbors = [];\n\n    if (x > 0) {\n      neighbors.push(this.intersectionAt(y, x - 1));\n    }\n\n    if (x < (this.boardSize - 1)) {\n      neighbors.push(this.intersectionAt(y, x + 1));\n    }\n\n    if (y > 0) {\n      neighbors.push(this.intersectionAt(y - 1, x));\n    }\n\n    if (y < (this.boardSize - 1)) {\n      neighbors.push(this.intersectionAt(y + 1, x));\n    }\n\n    return neighbors;\n  },\n\n  positionSameAs: function(otherState) {\n    return this._positionHash === otherState._positionHash && this.intersections.every(point => {\n      return point.sameColorAs(otherState.intersectionAt(point.y, point.x));\n    });\n  },\n\n  // Iterative depth-first search traversal. Start from\n  // startingPoint, iteratively follow all neighbors.\n  // If inclusionConditionis met for a neighbor, include it\n  // otherwise, exclude it. At the end, return two arrays:\n  // One for the included neighbors, another for the remaining neighbors.\n  partitionTraverse: function(startingPoint, inclusionCondition) {\n    let checkedPoints = [];\n    let boundaryPoints = [];\n    let pointsToCheck = [];\n\n    pointsToCheck.push(startingPoint);\n\n    while (pointsToCheck.length > 0) {\n      const point = pointsToCheck.pop();\n\n      if (checkedPoints.indexOf(point) > -1) {\n        // skip it, we already checked\n      } else {\n        checkedPoints.push(point);\n\n        this.neighborsFor(point.y, point.x).forEach(neighbor => {\n          if (checkedPoints.indexOf(neighbor) > -1) {\n            // skip this neighbor, we already checked it\n          } else {\n            if (inclusionCondition(neighbor)) {\n              pointsToCheck.push(neighbor);\n            } else {\n              boundaryPoints.push(neighbor);\n            }\n          }\n        });\n      }\n    }\n\n    return [checkedPoints, utils.unique(boundaryPoints)];\n  }\n};\n\nBoardState._initialFor = function(boardSize, handicapStones) {\n  this._cache = this._cache || {};\n  this._cache[boardSize] = this._cache[boardSize] || {};\n\n  if (this._cache[boardSize][handicapStones]) {\n    return this._cache[boardSize][handicapStones];\n  }\n\n  let emptyPoints = Array.apply(null, Array(boardSize * boardSize));\n  emptyPoints = emptyPoints.map((x, i) => {\n    return new Intersection(Math.floor(i / boardSize), i % boardSize);\n  });\n\n  const hoshiOffset = boardSize > 11 ? 3 : 2;\n  const hoshiPoints = {\n    topRight:     { y: hoshiOffset,                 x: boardSize - hoshiOffset - 1 },\n    bottomLeft:   { y: boardSize - hoshiOffset - 1, x: hoshiOffset },\n    bottomRight:  { y: boardSize - hoshiOffset - 1, x: boardSize - hoshiOffset - 1 },\n    topLeft:      { y: hoshiOffset,                 x: hoshiOffset },\n    middle:       { y: (boardSize + 1)/2 - 1,       x: (boardSize + 1)/2 - 1 },\n    middleLeft:   { y: (boardSize + 1)/2 - 1,       x: hoshiOffset },\n    middleRight:  { y: (boardSize + 1)/2 - 1,       x: boardSize - hoshiOffset - 1 },\n    middleTop:    { y: hoshiOffset,                 x: (boardSize + 1)/2 - 1 },\n    middleBottom: { y: boardSize - hoshiOffset - 1, x: (boardSize + 1)/2 - 1 }\n  };\n  const handicapPlacements = {\n    0: [],\n    1: [],\n    2: [hoshiPoints.topRight, hoshiPoints.bottomLeft],\n    3: [hoshiPoints.topRight, hoshiPoints.bottomLeft, hoshiPoints.bottomRight],\n    4: [hoshiPoints.topRight, hoshiPoints.bottomLeft, hoshiPoints.bottomRight, hoshiPoints.topLeft],\n    5: [hoshiPoints.topRight, hoshiPoints.bottomLeft, hoshiPoints.bottomRight, hoshiPoints.topLeft, hoshiPoints.middle],\n    6: [hoshiPoints.topRight, hoshiPoints.bottomLeft, hoshiPoints.bottomRight, hoshiPoints.topLeft, hoshiPoints.middleLeft, hoshiPoints.middleRight],\n    7: [hoshiPoints.topRight, hoshiPoints.bottomLeft, hoshiPoints.bottomRight, hoshiPoints.topLeft, hoshiPoints.middleLeft, hoshiPoints.middleRight, hoshiPoints.middle],\n    8: [hoshiPoints.topRight, hoshiPoints.bottomLeft, hoshiPoints.bottomRight, hoshiPoints.topLeft, hoshiPoints.middleLeft, hoshiPoints.middleRight, hoshiPoints.middleTop, hoshiPoints.middleBottom],\n    9: [hoshiPoints.topRight, hoshiPoints.bottomLeft, hoshiPoints.bottomRight, hoshiPoints.topLeft, hoshiPoints.middleLeft, hoshiPoints.middleRight, hoshiPoints.middleTop, hoshiPoints.middleBottom, hoshiPoints.middle]\n  };\n\n  handicapPlacements[handicapStones].forEach(p => {\n    emptyPoints[p.y*boardSize + p.x] = new Intersection(p.y, p.x, \"black\");\n  });\n\n  const initialState = new BoardState({\n    color: handicapStones > 1 ? \"black\" : \"white\",\n    moveNumber: 0,\n    intersections: Object.freeze(emptyPoints),\n    blackStonesCaptured: 0,\n    whiteStonesCaptured: 0,\n    whitePassStones: 0,\n    blackPassStones: 0,\n    boardSize: boardSize\n  });\n\n  this._cache[boardSize][handicapStones] = initialState;\n  return initialState;\n};\n\nexport default BoardState;\n"]}